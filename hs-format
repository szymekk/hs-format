#!/bin/bash

check_only=

while [[ $# -gt 0 ]]
do
key="$1"

case $key in
    --check)
    check_only=1
    shift
    ;;
    *)
    shift
    ;;
esac
done

extensions=(hs lhs)
git_flags=(--cached --others --exclude-standard)
patterns=( "${extensions[@]/#/*.}" )
if [[ -n $check_only ]]; then
    git ls-files -z "${git_flags[@]}" "${patterns[@]}" |
    xargs -0 -I % bash -c 'ormolu --mode=check "%" || echo \"%\" "needs formatting"'
    exit
fi

git ls-files -z "${git_flags[@]}" "${patterns[@]}" |
xargs -0 printf -- ' "%s"\n' |
xargs ormolu --mode=inplace
